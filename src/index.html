<!doctype html>
<html lang="en">
<head>
		<meta charset="UTF-8">
		<meta name="viewport"
					content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
		<meta http-equiv="X-UA-Compatible" content="ie=edge">
		<title>Climate By Station</title>

		<script src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/2.5.1/plotly-basic.min.js" integrity="sha512-UKHNc6UAUh7ZjzSmyiNKZEdG9QICEZnjF+OEdqIGPi1NsKdhulHlsAcl2fu9+4ughCqpTMewKIIUuUvVsjdOvQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

		<script src="./climate_by_station_widget.js"></script>

</head>
<body>

	<div>
			<div>
					<label for="station">Station Id:</label>
					<input name="station" id="station" value="USC00094429">
					<div>
							<button id="update">Update</button>
					</div>
			</div>
			<div>
					<label for="variables">Variables:</label>

					<select name="variables" id="variables">
							<option value="precipitation">Precipitation</option>
							<option value="tmax">TMax</option>
							<option value="tmin">TMin</option>
							<option value="tavg">TAvg</option>
					</select>
			</div>
			<div>
					<label for="window">Window:</label>
					<input type="number" name="window" id="window" value="1">
			</div>
			<div>
					<label for="threshold">Threshold:</label>
					<input type="number" step="0.25" name="threshold" id="threshold" value="1">
			</div>
			<div>
					<label for="operators">Operators:</label>

					<select name="operators" id="operators">
							<option value=">">Greater than | ></option>
							<option value=">=">Greater than or Equals | >=</option>
							<option value="<">Less than | <</option>
							<option value="<=">Less than or Equals | <=</option>
							<option value="==">Equals | ==</option>
					</select>
			</div>
			<div>
					<label for="percentile">Percentiles:</label>

					<select name="percentile" id="percentile">
							<option value="80">80th</option>
							<option value="90">90th</option>
							<option value="95">95th</option>
					</select>
			</div>
	</div>

	<div id="threshold-graph"></div>

		<script type="module">

				let element = document.getElementById("threshold-graph");

				const widget = new ClimateByStationWidget(element, {});

				window.widget = widget;

				let stationElement = document.getElementById("station");
				let updateElement = document.getElementById("update");
				let windowElement = document.getElementById("window");
				let thresholdElement = document.getElementById("threshold");
				let variableElement = document.getElementById("variables");
				let operatorElement = document.getElementById("operators");
				let percentileElement = document.getElementById("percentile");

				windowElement.addEventListener('change', function(e) {
						let value = e.target.value;

						if(value < 1) {
								value = 1;
						}

						windowElement.value = value;
					  widget.update({window: Number.parseInt(value)})
				})

				thresholdElement.addEventListener('change', function(e) {
						let value = e.target.value;

						if(value < 0.0) {
								value = 0.0;
						}

						thresholdElement.value = value;
						widget.update({threshold: Number.parseFloat(value)})
				})

				variableElement.addEventListener('change', function(e) {
						let value = e.target.value;
						let threshold;
						let window_behaviour;

						if(value === 'precipitation') {
								threshold = 1.0;
								window_behaviour = 'rollingSum';
						} else if(value === 'tmax') {
								threshold = 95.0;
								window_behaviour = 'all';
						} else if(value === 'tmin') {
								threshold = 32.0;
								window_behaviour = 'all';
						} else {
								threshold = 70.0;
								window_behaviour = 'all';
						}

						thresholdElement.value = threshold;

						widget.update({variable: value, threshold: threshold, window_behaviour: window_behaviour})
				})

				stationElement.addEventListener('change', function(e) {
						let value = e.target.value;
						stationElement.value = value;
				})

				updateElement.addEventListener('click', function(e) {
						e.preventDefault();

						let value = stationElement.value;
						widget.update({station: value});
				})

				operatorElement.addEventListener('change', function(e) {
						let value = e.target.value;

						widget.update({thresholdOperator: value});
				})

				percentileElement.addEventListener('change', function(e) {
						let value = e.target.value;

						let updatedThreshold = widget.view._get_percentile_value(Number.parseInt(value));

						thresholdElement.value = updatedThreshold;
						widget.update({threshold: updatedThreshold});
				})

		</script>
</body>
</html>
